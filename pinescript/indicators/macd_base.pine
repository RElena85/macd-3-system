// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MACD MONEY MAP - BASE INDICATOR (PHASE 1 IMPLEMENTATION)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Version: 1.1.0
// Components:
// 1. Core MACD Calculation
// 2. Enhanced Histogram Visualization (4-color momentum)
// 3. Zero Line Bias Background
// 4. Distance-from-Zero Calculation (The "Chop Zone" Filter)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

//@version=6
indicator("MACD Money Map - Base", shorttitle="MACD-MM Base", overlay=false)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. SETTINGS & CONFIGURATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Group: MACD Constants
grp_macd = "MACD Settings"
fastLength   = input.int(12, "Fast Length", minval=1, group=grp_macd)
slowLength   = input.int(26, "Slow Length", minval=1, group=grp_macd)
signalLength = input.int(9, "Signal Length", minval=1, group=grp_macd)
src          = input.source(close, "Source", group=grp_macd)

// Group: Distance Filter (System 1 Chop Zone)
grp_dist = "Distance Filter (Chop Zone)"
useATR       = input.bool(true, "Use Volatility (ATR) for Threshold?", group=grp_dist, 
              tooltip="Recommended: True. Adjusts the 'chop zone' size based on market volatility.")
atrLen       = input.int(14, "ATR Length", minval=1, group=grp_dist)
atrMult      = input.float(1.0, "ATR Multiplier", minval=0.1, step=0.1, group=grp_dist,
              tooltip="Crypto: 1.5-2.0 | Forex: 1.0 | Stocks: 1.2")
fixedThreshold = input.float(0.0001, "Fixed Threshold (if ATR off)", minval=0.0, step=0.0001, group=grp_dist)

// Group: Visuals
grp_vis = "Visual Settings"
showBiasBg   = input.bool(true, "Show Trend Bias Background", group=grp_vis)
showDistLines= input.bool(true, "Show Chop Zone Lines", group=grp_vis)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. CALCULATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 2.1 MACD Core
[macdLine, signalLine, histLine] = ta.macd(src, fastLength, slowLength, signalLength)

// 2.2 Distance Threshold Calculation
// If using ATR, threshold is dynamic. If fixed, it's static.
volatility_atr = ta.atr(atrLen)
current_threshold = useATR ? (volatility_atr * atrMult) : fixedThreshold

// 2.3 Distance Logic
dist_from_zero = math.abs(macdLine)
is_qualified   = dist_from_zero >= current_threshold // "Qualified" means OUTSIDE the chop zone
is_chop_zone   = not is_qualified

// 2.4 Bias Determination (Zero Line Rule)
is_bullish_bias = macdLine > 0
is_bearish_bias = macdLine < 0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. VISUALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 3.1 Background Color (The Zero Line Bias)
// Green tint if MACD > 0, Red tint if MACD < 0
bg_color = not showBiasBg ? na :
           is_bullish_bias ? color.new(color.green, 95) :
           is_bearish_bias ? color.new(color.red, 95) : na
bgcolor(bg_color, title="Trend Bias Background")

// 3.2 Enhanced Histogram (4 Colors)
// Bright Green: Positive & Growing
// Pale Green:   Positive & Shrinking (Exhaustion)
// Bright Red:   Negative & Growing
// Pale Red:     Negative & Shrinking (Exhaustion)
hist_color = if histLine >= 0
    histLine > histLine[1] ? color.new(#26a69a, 0) : color.new(#26a69a, 60)
else
    histLine < histLine[1] ? color.new(#ef5350, 0) : color.new(#ef5350, 60)

plot(histLine, title="Histogram", style=plot.style_columns, color=hist_color)

// 3.3 Lines
plot(macdLine,   title="MACD Line",   color=#2962FF, linewidth=2)
plot(signalLine, title="Signal Line", color=#FF6D00, linewidth=1)
hline(0, "Zero Line", color=color.gray, linestyle=hline.style_solid)

// 3.4 Chop Zone Thresholds
// Visualizes the area you should NOT trade crossovers in
u_zone = plot(showDistLines ? current_threshold : na, "Upper Chop Limit", color=color.new(color.gray, 50), style=plot.style_linebr)
l_zone = plot(showDistLines ? -current_threshold : na, "Lower Chop Limit", color=color.new(color.gray, 50), style=plot.style_linebr)
fill(u_zone, l_zone, color=color.new(color.gray, 90), title="Chop Zone Fill")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. DATA WINDOW / INSPECTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Helps you see values when hovering
plotchar(is_qualified, "Qualified?", "", location.top, color=color.black, size=size.tiny)
plotchar(current_threshold, "Threshold", "", location.top, color=color.black, size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 5. STATUS DASHBOARD (Bottom Right)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var table info_table = table.new(position.bottom_right, 2, 3, bgcolor=color.new(color.black, 50), border_color=color.black)

if barstate.islast
    // Header
    table.cell(info_table, 0, 0, "MACD STATUS", text_color=color.white, text_size=size.small, bgcolor=color.new(color.blue, 80))
    table.cell(info_table, 1, 0, "VALUE", text_color=color.white, text_size=size.small, bgcolor=color.new(color.blue, 80))
    
    // Bias Row
    table.cell(info_table, 0, 1, "Market Bias", text_color=color.white, text_size=size.small)
    table.cell(info_table, 1, 1, is_bullish_bias ? "LONG ONLY ðŸŸ¢" : "SHORT ONLY ðŸ”´", 
               text_color=is_bullish_bias ? color.green : color.red, text_size=size.small)
    
    // Distance Row
    table.cell(info_table, 0, 2, "Zone", text_color=color.white, text_size=size.small)
    table.cell(info_table, 1, 2, is_qualified ? "TRADABLE âœ¨" : "CHOP ZONE âš ï¸", 
               text_color=is_qualified ? color.green : color.orange, text_size=size.small)

